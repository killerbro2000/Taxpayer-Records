<!DOCTYPE html>
<html>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script> <!-- contains firebase.initializeApp(firebaseConfig) -->
<script src="app.js"></script>
<table>
  <tbody id="recordTableBody"></tbody>
</table>
<head>
  <meta charset="UTF-8">
  <title>Taxpayer Records Manager</title>
  <style>
.tab-button {
  padding: 8px 16px;
  margin-right: 8px;
  border: none;
  background-color: #eee;
  cursor: pointer;
  border-radius: 5px;
  font-weight: bold;
}

.tab-button.active {
  background-color: #007bff;
  color: white;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}

@keyframes glow {
  0%   { box-shadow: 0 0 0px red; }
  50%  { box-shadow: 0 0 12px red; }
  100% { box-shadow: 0 0 0px red; }
}

.glow {
  animation: glow 0.8s ease-in-out;
}

/* Sleek table container */
table {
  width: 100%;
  border-collapse: collapse;
  font-family: Arial, sans-serif;
}

/* Header style */
th {
  background-color: #f5f5f5;
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid #ddd;
  font-weight: bold;
}

/* Fitted row styling */
td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  font-size: 0.95em;
}

/* Hover effect for rows */
tr:hover {
  background-color: #f9f9f9;
}

/* Clean button styling */
button {
  padding: 5px 12px;
  border: none;
  border-radius: 4px;
  font-size: 0.9em;
  cursor: pointer;
}

button.edit {
  background-color: #4CAF50;
  color: white;
}

button.delete {
  background-color: #f44336;
  color: red;
}

.copy-cell {
  cursor: pointer;
  padding: 6px;
  border-radius: 4px;
  font-weight: bold;
}

.copy-cell:hover {
  filter: brightness(1.1);
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

/* Individual field colors */
.cnic     { background-color: #bbdefb; color: #b71c1c; }   /* soft red */
.phone    { background-color: #bbdefb; color: #1b5e20; }   /* soft green */
.password { background-color: #bbdefb; color: #f57f17; }   /* golden yellow */
.email    { background-color: #bbdefb; color: #0d47a1; }   /* blue-ish */
.pin      { background-color: #bbdefb; color: #6a1b9a; }   /* violet */

.tab-button {
  background-color: #eee;
  color: #333;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  cursor: pointer;
  border-radius: 5px;
  font-weight: bold;
  transition: background-color 0.3s;
    }

    .tab-button:hover {
      background-color: #d6e4ff;
    }

    .tab-btn.active-tab {
      background: green;
      opacity: 1;
    }

    .tab-btn.inactive-tab {
      background: red;
      opacity: 1;
    }

    .tab-btn.archived-tab {
      background: goldenrod;
      opacity: 1;
    }

    .tab-button.active {
      background-color: #90caf9; /* Highlight for active tab */
      color: white;
    }

    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-bottom: 10px; }

    button {
      padding: 8px 12px;
      margin-right: 5px;
      margin-top: 10px;
    }

    input { padding: 6px; margin-top: 5px; width: 250px; }

    .tab-btn {
      padding: 6px 12px;
      margin-right: 8px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }

    .all-tab { background: blue; }
    .active-tab { background: green; }
    .inactive-tab { background: red; }
    .archived-tab { background: goldenrod; }

    .popup, #popupBackdrop {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: none;
      z-index: 999;
    }

    #popupBackdrop {
      background: rgba(0, 0, 0, 0.3);
    }

    .popup {
      justify-content: center;
      background: white;
      width: 320px;
      padding: 20px;
      border-radius: 8px;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 999;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }

    .status-green { background: #d4fdd4; }
    .status-red { background: #ffd4d4; }
    .status-yellow { background: #fffdd4; }

    .actions button {
      margin-right: 4px;
    }

      button, input, select {
      transition: all 0.3s ease;
      border-radius: 8px;
    }

      button:hover {
      transform: scale(1.05);
      background-color: limegreen;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

input { padding: 6px; margin-top: 5px; width: 250px; }

.tab-btn {
  background-color: #f0f0f0;
  color: #333;
  border: none;
  padding: 8px 16px;
  margin: 4px;
  border-radius: 6px;
  font-weight: bold;
  transition: background 0.3s;
  cursor: pointer;
}

.sync-btn {
  display: inline-block;
  background: #28a745;
  color: white;
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  float: right; /* ðŸ‘ˆ Moves button to the left */
  margin-top: 10px;
}

.add-btn {
  display: inline-block;
  background: #28a745;
  color: white;
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  float: right; /* ðŸ‘ˆ Moves button to the left */
  margin-top: 10px;

.tab-btn.active {
  background-color: #42a5f5; /* highlighted blue */
  color: white;
}

    .all-tab { background: goldenrod; }
    .active-tab { background: green; }
    .inactive-tab { background: red; }
    .archived-tab { background: goldenrod; }

    .hidden { display: none; }
  </style>
</head>
<body>

<div class="top-bar">
<div id="loginScreen" style="
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: silver;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    width: 300px;
    text-align: center;
  ">
    <h2>(IN DEVELOPMENT)</h2>
    <h2>Login</h2>
    <input type="text" id="usernameInput" placeholder="Username" style="width: 100%; margin-bottom: 10px; padding: 8px;" />
    <input type="password" id="passwordInput" placeholder="Password" style="width: 100%; margin-bottom: 10px; padding: 8px;" />
    <button onclick="validateLogin()" style="padding: 10px 20px; font-weight: bold; background: teal; color: white; border: none; border-radius: 6px;">Login</button>
<button onclick="showChangePassword()" style="padding: 8px 20px; background: #555; color: white; border: none; border-radius: 6px; margin-top: 10px;">Change Password</button>
    <p id="loginError" style="color: red; margin-top: 10px; display: none;">Invalid credentials</p>
  </div>
</div>
<div id="changePasswordPopup" style="
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 3000;
">
  <div style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    width: 320px;
    text-align: center;
">
    <h3>Change Password</h3>
    <input type="password" id="oldPassword" placeholder="Old password" style="width: 100%; margin-bottom: 10px; padding: 8px;" />
    <input type="password" id="newPassword" placeholder="New password" style="width: 100%; margin-bottom: 10px; padding: 8px;" />
    <button onclick="changePassword()" style="padding: 8px 16px; background: teal; color: white; border: none; border-radius: 6px;">Confirm</button>
    <button onclick="closeChangePopup()" style="padding: 8px 16px; background: #999; color: white; border: none; border-radius: 6px; margin-left: 8px;">Cancel</button>
    <p id="passwordChangeMsg" style="color: red; margin-top: 10px; display: none;"></p>
  </div>
</div>

<h2>Taxpayer Record Manager</h2>

<!-- Search & Tabs -->
<input id="searchInput" type="text" placeholder="Search..." oninput="filterRecords()" autocomplete="off" />

<div style="margin-top:10px;"> 
<button class="tab-btn Active-tab" onclick="setStatusFilter('Active')">Active</button>
<button class="tab-btn Inactive-tab" onclick="setStatusFilter('Inactive')">Inactive</button>
<button class="tab-btn Archived-tab" onclick="setStatusFilter('Archived')">Archived</button>
  <button class="add-btn" onclick="openAddPopup()">Add Record</button>
  <button class="sync-btn" id="syncButton">Sync Records</button>
</div>

<!-- Table -->
<table>
  <thead>
    <tr>
      <th>Name</th><th>Status</th><th>CNIC</th><th>Password</th><th>PIN</th>
      <th>Email</th><th>Phone</th><th>Added On</th><th>Actions</th>
    </tr>
  </thead>
  <tbody id="recordTable"></tbody>
</table>

<!-- Backdrop -->
<div id="popupBackdrop" onclick="closePopup()"></div>

<!-- Add/Edit Popup -->
<div id="editPopup" class="popup">
  <h3 id="popupTitle">Add Record</h3>
  <input id="nameInput" placeholder="Name" /><br><br>
  <input id="cnicInput" placeholder="CNIC" /><br><br>
  <select id="statusInput">
    <option value="Active">Active</option>
    <option value="Inactive">Inactive</option>
    <option value="Archived">Archived</option>
  </select><br><br>
  <input id="passwordInput" placeholder="Password" /><br><br>
  <input id="pinInput" placeholder="PIN" /><br><br>
  <input id="emailInput" placeholder="Email" /><br><br>
  <input id="phoneInput" placeholder="Cell Number" /><br><br>
  <input id="dateInput" type="date" /><br><br>
  <button onclick="saveRecord()">Save</button>
</div>

<script>
  let records = JSON.parse(localStorage.getItem("taxRecords")) || [];
  let editingIndex = null;
  let currentFilter = "Active";

  function copyToClipboard(value) {
    navigator.clipboard.writeText(value).then(() => {
      showCopyFeedback(value);
    }).catch(err => {
      console.error("âŒ Copy failed:", err);
    });
  }

  function showCopyFeedback(value) {
    const toast = document.createElement("div");
    toast.textContent = `âœ… Copied: ${value}`;
    toast.style = `
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-family: sans-serif;
      z-index: 9999;
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
  }

  function setStatusFilter(status) {
  currentFilter = status;
  filterRecords();

  // Reset all tab classes
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.classList.remove("active-tab", "inactive-tab", "archived-tab");
  });

  // Highlight the selected tab
  const selectedBtn = [...document.querySelectorAll(".tab-btn")].find(btn =>
    btn.textContent.includes(status)
  );

  if (selectedBtn) {
    const highlightClass = {
      "All": "all-tab",
      "Active": "active-tab",
      "Inactive": "inactive-tab",
      "Archived": "archived-tab",
    }[status];
    selectedBtn.classList.add(highlightClass);
  }
}

function filterTab(status) {
  const allRecords = JSON.parse(localStorage.getItem("records")) || [];

  const filtered = status === "All"
    ? allRecords
    : allRecords.filter(r => r.status === status);

  renderTable(filtered);
}

  function filterRecords() {
    const query = document.getElementById("searchInput").value.toLowerCase();

    const filtered = records
      .map((r, i) => ({ ...r, originalIndex: i })) // attach true index
      .filter(r =>
        r.status === currentFilter && // ðŸ‘ˆ filter by selected tab
        Object.values(r).some(val =>
          typeof val === "string" && val.toLowerCase().includes(query)
        )
      );
    renderTable(filtered);
  }

  function renderTable(data) {
  const tbody = document.getElementById("recordTable");
  tbody.innerHTML = "";

  data.forEach(r => {
    const row = document.createElement("tr");
    row.className = {
      "Active": "status-green",
      "Inactive": "status-red",
      "Archived": "status-yellow"
    }[r.status];
    row.innerHTML = `
      <td>${r.name}</td>
      <td>${r.status}</td>
      <td class="copy-cell cnic" onclick="copyToClipboard('${r.cnic}')">${r.cnic}</td>
      <td class="copy-cell password" onclick="copyToClipboard('${r.password}')">${r.password}</td>
      <td class="copy-cell pin" onclick="copyToClipboard('${r.pin}')">${r.pin}</td>
      <td class="copy-cell email" onclick="copyToClipboard('${r.email}')">${r.email}</td>
      <td class="copy-cell phone" onclick="copyToClipboard('${r.phone}')">${r.phone}</td>
      <td>${r.date}</td>
      <td>
        <button class="edit-btn" onclick="editRecord(${r.originalIndex})">Edit</button>
        <button onclick="deleteRecord(${r.originalIndex})">Delete</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

function showAllStatuses() {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector('.All-tab')?.classList.add('active');

  const allRecords = JSON.parse(localStorage.getItem("records")) || [];

  // Include all records where status is Active, Inactive, or Archived
  const filtered = allRecords.filter(r =>
    ["Active", "Inactive", "Archived"].includes(r.status)
  );

  renderTable(filtered);
}

  function openAddPopup() {
    editingIndex = null;
    document.getElementById("popupTitle").textContent = "Add Record";
    document.querySelectorAll("#editPopup input, #statusInput").forEach(el => {
      if (el.id === "dateInput") {
        el.value = new Date().toISOString().slice(0,10);
      } else {
        el.value = "";
      }
    });
    document.getElementById("statusInput").value = "Active";
    showPopup();
  }

  function editRecord(i) {
    editingIndex = i;
    const r = records[i];
    document.getElementById("popupTitle").textContent = "Edit Record";
    document.getElementById("nameInput").value = r.name;
    document.getElementById("cnicInput").value = r.cnic;
    document.getElementById("statusInput").value = r.status;
    document.getElementById("passwordInput").value = r.password;
    document.getElementById("pinInput").value = r.pin;
    document.getElementById("emailInput").value = r.email;
    document.getElementById("phoneInput").value = r.phone;
    document.getElementById("dateInput").value = r.date;
    showPopup();
  }

  function showPopup() {
    document.getElementById("popupBackdrop").style.display = "block";
    document.getElementById("editPopup").style.display = "block";
    document.body.style.overflow = "hidden";
  }

  function closePopup() {
    document.getElementById("popupBackdrop").style.display = "none";
    document.getElementById("editPopup").style.display = "none";
    document.body.style.overflow = "";
  }

function saveRecord(record) {
  firebase.database().ref('records').push(newRecord);
}

function loadRecords(callback) {
  firebase.database().ref('records').on('value', snapshot => {
    const data = snapshot.val();
    callback(data);
  });
}

function getRecordsToSync() {
  const stored = localStorage.getItem("records");
  return stored ? JSON.parse(stored) : [];
}

  function saveRecord() {
    const newRecord = {
      name: document.getElementById("nameInput").value.trim(),
      cnic: document.getElementById("cnicInput").value.trim(),
      status: document.getElementById("statusInput").value,
      password: document.getElementById("passwordInput").value.trim(),
      pin: document.getElementById("pinInput").value.trim(),
      email: document.getElementById("emailInput").value.trim(),
      phone: document.getElementById("phoneInput").value.trim(),
      date: document.getElementById("dateInput").value
    };

    if (editingIndex !== null) {
      records[editingIndex] = newRecord;
    } else {
      records.push(newRecord);
    }

    localStorage.setItem("taxRecords", JSON.stringify(records));
    closePopup();
    filterRecords();
  }

function highlightActiveTab(tabId) {
  document.querySelectorAll(".tab-button").forEach(btn => {
    btn.classList.remove("active");
  });
  document.querySelector(`#${tabId}`).classList.add("active");
}

function validateLogin() {
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();

    const storedPassword = localStorage.getItem('userPassword') || '1234';

    if (username === 'admin' && password === storedPassword) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('loginError').style.display = 'none';
    } else {
      document.getElementById('loginError').style.display = 'block';
      document.getElementById('loginError').classList.add('glow');
      setTimeout(() => {
      document.getElementById('loginError').classList.remove('glow');
     }, 800);

    }
  }

  function showChangePassword() {
    document.getElementById('changePasswordPopup').style.display = 'flex';
  }

  function closeChangePopup() {
    document.getElementById('changePasswordPopup').style.display = 'none';
  }

  function changePassword() {
    const oldPass = document.getElementById('oldPassword').value;
    const newPass = document.getElementById('newPassword').value;
    const storedPassword = localStorage.getItem('userPassword') || '1234';

    if (oldPass === storedPassword) {
      localStorage.setItem('userPassword', newPass);
      document.getElementById('passwordChangeMsg').style.color = 'green';
      document.getElementById('passwordChangeMsg').innerText = 'Password updated!';
    } else {
      document.getElementById('passwordChangeMsg').style.color = 'red';
      document.getElementById('passwordChangeMsg').innerText = 'Wrong old password.';
      document.getElementById('passwordChangeMsg').classList.add('glow');
      setTimeout(() => {
      document.getElementById('passwordChangeMsg').classList.remove('glow');
     }, 800);

    }

    document.getElementById('passwordChangeMsg').style.display = 'block';
  }

function showToast(message) {
  const toast = document.createElement("div");
  toast.className = "toast";
  toast.innerText = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

showToast("âœ… Records successfully synced!");

  function deleteRecord(i) {
    if (confirm("Are you sure you want to delete this record?")) {
      records.splice(i, 1);
      localStorage.setItem("taxRecords", JSON.stringify(records));
      filterRecords();
    }
  }

  filterRecords(); // Initial load
</script>
<script src="cloud-sync.js"></script>
</body>
</html>
